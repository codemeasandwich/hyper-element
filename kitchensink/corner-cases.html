<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Corner Cases - hyper-element Kitchen Sink</title>
  <script src="https://cdn.jsdelivr.net/npm/hyperhtml@latest/min.js"></script>
  <script src="test-loader.js"></script>
  <style>
    body { font-family: sans-serif; padding: 2rem; }
    section { margin: 2rem 0; padding: 1rem; border: 1px solid #ddd; border-radius: 4px; }
    section[data-test-result="pass"] { border-color: green; background: #f0fff0; }
    section[data-test-result="fail"] { border-color: red; background: #fff0f0; }
    h1 { border-bottom: 2px solid #333; }
    h2 { margin-top: 0; }
    pre { background: #f5f5f5; padding: 1rem; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>Corner Cases</h1>
  <p>Edge cases and unusual scenarios for comprehensive testing.</p>

  <section data-test="empty-render" data-test-result="pending">
    <h2>Empty Render</h2>
    <p>Element with no content rendered.</p>
    <empty-element></empty-element>
    <script>
      customElements.define("empty-element", class extends hyperElement {
        render(Html) {
          Html``
        }
      });

      requestAnimationFrame(() => {
        const section = document.querySelector('[data-test="empty-render"]');
        const elem = document.querySelector('empty-element');
        // Should exist but be empty
        if (elem && elem.textContent.trim() === '') {
          section.dataset.testResult = 'pass';
        } else {
          section.dataset.testResult = 'fail';
        }
      });
    </script>
  </section>

  <section data-test="multiple-renders" data-test-result="pending">
    <h2>Multiple Renders</h2>
    <p>Element that renders and can be triggered to re-render.</p>
    <multi-render-element></multi-render-element>
    <script>
      let multiRenderCount = 0;
      customElements.define("multi-render-element", class extends hyperElement {
        render(Html) {
          multiRenderCount++;
          Html`Render count: ${multiRenderCount}`
        }
      });

      // Element should have rendered at least once on creation
      requestAnimationFrame(() => {
        const section = document.querySelector('[data-test="multiple-renders"]');
        const elem = document.querySelector('multi-render-element');
        // Should have rendered at least once
        if (elem && multiRenderCount >= 1 && elem.textContent.includes('Render count:')) {
          section.dataset.testResult = 'pass';
        } else {
          section.dataset.testResult = 'fail';
        }
      });
    </script>
  </section>

  <section data-test="special-chars" data-test-result="pending">
    <h2>Special Characters</h2>
    <p>Handling special characters in content and attributes.</p>
    <special-chars-element data-text="&lt;b&gt;bold&lt;/b&gt;"></special-chars-element>
    <script>
      customElements.define("special-chars-element", class extends hyperElement {
        render(Html) {
          // Should handle HTML entities in text content
          Html`Text: ${this.attrs['data-text']}`
        }
      });

      requestAnimationFrame(() => {
        const section = document.querySelector('[data-test="special-chars"]');
        const elem = document.querySelector('special-chars-element');
        // Should contain the HTML entities as text
        if (elem && elem.textContent.includes('<b>') && elem.textContent.includes('</b>')) {
          section.dataset.testResult = 'pass';
        } else {
          section.dataset.testResult = 'fail';
        }
      });
    </script>
  </section>

  <section data-test="unicode-content" data-test-result="pending">
    <h2>Unicode Content</h2>
    <p>Handling unicode characters and emojis.</p>
    <unicode-element></unicode-element>
    <script>
      customElements.define("unicode-element", class extends hyperElement {
        render(Html) {
          Html`Unicode: Hello World`
        }
      });

      requestAnimationFrame(() => {
        const section = document.querySelector('[data-test="unicode-content"]');
        const elem = document.querySelector('unicode-element');
        if (elem && elem.textContent.includes('Hello World')) {
          section.dataset.testResult = 'pass';
        } else {
          section.dataset.testResult = 'fail';
        }
      });
    </script>
  </section>

  <a href="index.html">&larr; Back to Kitchen Sink</a>
</body>
</html>
