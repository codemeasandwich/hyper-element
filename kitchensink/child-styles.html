<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Child Styles - hyper-element Kitchen Sink</title>
    <script src="https://cdn.jsdelivr.net/npm/hyperhtml@latest/min.js"></script>
    <script src="test-loader.js"></script>
    <style>
      body {
        font-family: sans-serif;
        padding: 2rem;
      }
      section {
        margin: 2rem 0;
        padding: 1rem;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
      section[data-test-result='pass'] {
        border-color: green;
        background: #f0fff0;
      }
      section[data-test-result='fail'] {
        border-color: red;
        background: #fff0f0;
      }
      h1 {
        border-bottom: 2px solid #333;
      }
      h2 {
        margin-top: 0;
      }
      pre {
        background: #f5f5f5;
        padding: 1rem;
        overflow-x: auto;
      }
    </style>
  </head>
  <body>
    <h1>Child Styles</h1>
    <p>Tests passing style objects to custom child elements.</p>

    <!-- Issue #12: Style not applied to custom child elements -->
    <section data-test="style-object-child" data-test-result="pending">
      <h2>Issue #12: Style Object on Child Element</h2>
      <p>
        Passing a style object to a custom child element should apply the
        styles.
      </p>
      <pre><code>// Parent passes style object to child:
Html\`&lt;child-elem style=${{color:"red"}}&gt;&lt;/child-elem&gt;\`

// Child should render with red text</code></pre>
      <parent-style-elem></parent-style-elem>
      <script>
        customElements.define(
          'child-style-elem',
          class extends hyperElement {
            render(Html) {
              Html`<span id="styled-content">I should be RED</span>`;
            }
          }
        );

        customElements.define(
          'parent-style-elem',
          class extends hyperElement {
            render(Html) {
              Html`<child-style-elem style=${{ color: 'red' }}></child-style-elem>`;
            }
          }
        );

        requestAnimationFrame(() => {
          setTimeout(() => {
            const section = document.querySelector(
              '[data-test="style-object-child"]'
            );
            const child = document.querySelector('child-style-elem');
            const computedColor = child ? getComputedStyle(child).color : '';
            // Red is rgb(255, 0, 0)
            const isRed = computedColor === 'rgb(255, 0, 0)';
            console.log('computed color:', computedColor, 'isRed:', isRed);
            section.dataset.testResult = isRed ? 'pass' : 'fail';
          }, 100);
        });
      </script>
    </section>

    <section data-test="style-object-with-callback" data-test-result="pending">
      <h2>Style Object Combined with Function</h2>
      <p>Passing both a style object and a callback function should work.</p>
      <parent-style-fn-elem></parent-style-fn-elem>
      <script>
        customElements.define(
          'child-style-fn-elem',
          class extends hyperElement {
            render(Html) {
              const msg =
                typeof this.attrs.callback === 'function'
                  ? this.attrs.callback()
                  : 'no fn';
              Html`<span id="styled-fn-content">${msg}</span>`;
            }
          }
        );

        customElements.define(
          'parent-style-fn-elem',
          class extends hyperElement {
            getMessage() {
              return 'PASS';
            }
            render(Html) {
              Html`<child-style-fn-elem callback=${this.getMessage} style=${{ color: 'blue' }}></child-style-fn-elem>`;
            }
          }
        );

        requestAnimationFrame(() => {
          setTimeout(() => {
            const section = document.querySelector(
              '[data-test="style-object-with-callback"]'
            );
            const child = document.querySelector('child-style-fn-elem');
            const content = document.querySelector('#styled-fn-content');
            const computedColor = child ? getComputedStyle(child).color : '';
            const isBlue = computedColor === 'rgb(0, 0, 255)';
            const textOk = content && content.textContent === 'PASS';
            console.log(
              'style+fn: color:',
              computedColor,
              'isBlue:',
              isBlue,
              'textOk:',
              textOk
            );
            section.dataset.testResult = isBlue && textOk ? 'pass' : 'fail';
          }, 100);
        });
      </script>
    </section>

    <a href="index.html">&larr; Back to Kitchen Sink</a>
  </body>
</html>
