<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Dataset - hyper-element Kitchen Sink</title>
  <script src="https://cdn.jsdelivr.net/npm/hyperhtml@latest/min.js"></script>
  <script src="../source/hyperElement.js"></script>
  <style>
    body { font-family: sans-serif; padding: 2rem; }
    section { margin: 2rem 0; padding: 1rem; border: 1px solid #ddd; border-radius: 4px; }
    section[data-test-result="pass"] { border-color: green; background: #f0fff0; }
    section[data-test-result="fail"] { border-color: red; background: #fff0f0; }
    h1 { border-bottom: 2px solid #333; }
    h2 { margin-top: 0; }
    pre { background: #f5f5f5; padding: 1rem; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>Dataset</h1>
  <p>Demonstrates using data-* attributes with automatic JSON parsing.</p>

  <section data-test="dataset-json" data-test-result="pending">
    <h2>JSON Array Parsing</h2>
    <p>Data attributes containing JSON are automatically parsed.</p>
    <pre><code>class extends hyperElement {
  render(Html) {
    // this.dataset.users is automatically parsed from JSON
    Html`Users: ${this.dataset.users.join(', ')}`
  }
}
// &lt;data-set-element data-users='["ann","bob"]'&gt;</code></pre>
    <script>
      customElements.define("data-set-element", class extends hyperElement {
        render(Html) {
          let ok = "fail";
          if (Array.isArray(this.dataset.users) && this.dataset.users.length) {
            ok = "pass";
          }
          Html`Users: ${this.dataset.users ? this.dataset.users.join(', ') : 'none'} (${ok})`
        }
      });

      const dataElem = document.createElement("data-set-element");
      dataElem.setAttribute("data-users", '["ann","bob"]');
      document.body.appendChild(dataElem);

      requestAnimationFrame(() => {
        const section = document.querySelector('[data-test="dataset-json"]');
        const elem = document.querySelector('data-set-element');
        if (elem && elem.textContent.includes('ann, bob') && elem.textContent.includes('pass')) {
          section.dataset.testResult = 'pass';
        } else {
          section.dataset.testResult = 'fail';
        }
      });
    </script>
  </section>

  <section data-test="dataset-check" data-test-result="pending">
    <h2>Dataset Check Element</h2>
    <p>Verifies both attrs and dataset contain expected values.</p>
    <pre><code>// this.attrs["data-json"] === "[1,2,3]" (string)
// this.dataset.json === [1,2,3] (parsed array)</code></pre>
    <dataset-check-element data-json="[1,2,3]"></dataset-check-element>
    <script>
      customElements.define("dataset-check-element", class extends hyperElement {
        render(Html) {
          if (this.attrs["data-json"] !== "[1,2,3]" ||
              !Array.isArray(this.dataset.json) ||
              this.dataset.json.length !== 3) {
            Html`dataset-check-element: FAIL`
            return;
          }
          Html`dataset-check-element: PASS (array has ${this.dataset.json.length} items)`
        }
      });

      requestAnimationFrame(() => {
        const section = document.querySelector('[data-test="dataset-check"]');
        const elem = document.querySelector('dataset-check-element');
        if (elem && elem.textContent.includes('PASS')) {
          section.dataset.testResult = 'pass';
        } else {
          section.dataset.testResult = 'fail';
        }
      });
    </script>
  </section>

  <a href="index.html">&larr; Back to Kitchen Sink</a>
</body>
</html>
