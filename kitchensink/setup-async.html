<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Async Setup - hyper-element Kitchen Sink</title>
  <script src="https://cdn.jsdelivr.net/npm/hyperhtml@latest/min.js"></script>
  <script src="test-loader.js"></script>
  <style>
    body { font-family: sans-serif; padding: 2rem; }
    section { margin: 2rem 0; padding: 1rem; border: 1px solid #ddd; border-radius: 4px; }
    section[data-test-result="pass"] { border-color: green; background: #f0fff0; }
    section[data-test-result="fail"] { border-color: red; background: #fff0f0; }
    h1 { border-bottom: 2px solid #333; }
    h2 { margin-top: 0; }
    pre { background: #f5f5f5; padding: 1rem; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>Async Setup</h1>
  <p>Demonstrates using the setup() method for async data initialization before rendering.</p>

  <section data-test="setup-element" data-test-result="pending">
    <h2>Setup with Async Data</h2>
    <p>The setup() method receives onNext which triggers re-renders with new data.</p>
    <pre><code>class extends hyperElement {
  setup(onNext) {
    setTimeout(onNext(() => "loaded!"), 10)
  }
  render(Html, data = "loading...") {
    Html`Status: ${data}`
  }
}</code></pre>
    <setup-element></setup-element>
    <script>
      customElements.define("setup-element", class extends hyperElement {
        setup(onNext) {
          setTimeout(onNext(() => "loaded!"), 10)
        }
        render(Html, data = "loading...") {
          Html`Status: ${data}`
        }
      });

      setTimeout(() => {
        const section = document.querySelector('[data-test="setup-element"]');
        const elem = document.querySelector('setup-element');
        if (elem && elem.textContent.includes('loaded!')) {
          section.dataset.testResult = 'pass';
        } else {
          section.dataset.testResult = 'fail';
        }
      }, 100);
    </script>
  </section>

  <a href="index.html">&larr; Back to Kitchen Sink</a>
</body>
</html>
